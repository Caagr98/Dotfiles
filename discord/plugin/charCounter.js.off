/* eslint-env jquery */
"use strict";

(() => {
	function inject() {
		const ta = $(".content textarea").parent();
		if(!ta.length || $("#charcounter").length) return;
		ta.append( $("<span/>", { "id": "charcounter", "text": `${$(".content textarea").val().length}/2000` }));
		$(".content textarea").off("keyup.charcounter").on("keyup.charCounter", e =>
			$("#charcounter").text(`${e.target.value.length}/2000`)
		);
	}

	function initObserver() {
		const switchObserver = new MutationObserver(function(mutations) {
			if(mutations.some(({addedNodes}) =>
				addedNodes.some(node =>
					node.classList != null && (node.classList.contains("chat") || node.classList.contains("messages-wrapper"))
				)
			)) inject();
		});
		const target = document.querySelector("#friends, .chat, .activityFeed-HeiGwL");
		if(target != null)
			switchObserver.observe(target.parentNode, {childList: true, subtree: true});
	}
	inject();
	initObserver();
})();
